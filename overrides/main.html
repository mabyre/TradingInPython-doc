{% extends "base.html" %}

{% block extrahead %}
{{ super() }}

{# ==== META BASE ==== #}

{% set meta_title = page.title ~ " - " ~ config.site_name %}

{# Locale #}
{% set meta_locale = "fr_FR" %}
{% if page and page.meta and page.meta.locale %}
{% set meta_locale = page.meta.locale %}
{% endif %}

{# Description (fallback vers site_description) #}
{% set meta_description = "" %}
{% if page and page.meta and page.meta.description %}
{% set meta_description = page.meta.description %}
{% elif config.site_description %}
{% set meta_description = config.site_description %}
{% endif %}

{# Keywords #}
{% set meta_keywords = "" %}
{% if page and page.meta and page.meta.keywords %}
{% set meta_keywords = page.meta.keywords %}
{% endif %}

{# Author (optionnel, mais sans doublon avec Material) #}
{% set meta_author = "" %}
{% if page and page.meta and page.meta.author %}
{% set meta_author = page.meta.author %}
{% endif %}

{# Image (page > extra.social_image) #}
{% set meta_image = "" %}
{% if page and page.meta and page.meta.image %}
{% set meta_image = page.meta.image %}
{% elif config.extra and config.extra.social_image %}
{% set meta_image = config.extra.social_image %}
{% endif %}

{# Transforme l'image en URL absolue #}
{% set meta_image_url = "" %}
{% if meta_image %}
{% if meta_image.startswith("http") %}
{% set meta_image_url = meta_image %}
{% elif config.site_url %}
{% set meta_image_url = config.site_url ~ "/" ~ meta_image %}
{% endif %}
{% endif %}

{# Canonical URL #}
{% set canonical_url = "" %}
{% if page and page.canonical_url %}
{% set canonical_url = page.canonical_url %}
{% endif %}

{# ==== EXTRA SEO META (Material gère déjà description + canonical) ==== #}

{% if meta_keywords %}
<meta name="keywords" content="{{ meta_keywords | e }}">
{% endif %}

{# IMPORTANT :
Material ajoute déjà souvent meta author.
Donc on ne l'injecte que si tu le veux vraiment.
#}
{# {% if meta_author %}
<meta name="author" content="{{ meta_author | e }}">
{% endif %} #}

{# ==== OPEN GRAPH ==== #}

<meta property="og:locale" content="{{ meta_locale | e }}">
<meta property="og:type" content="website">
<meta property="og:title" content="{{ meta_title | e }}">
<meta property="og:site_name" content="{{ config.site_name | e }}">

{% if meta_description %}
<meta property="og:description" content="{{ meta_description | e }}">
{% endif %}

{% if canonical_url %}
<meta property="og:url" content="{{ canonical_url | e }}">
{% endif %}

{% if meta_image_url %}
<meta property="og:image" content="{{ meta_image_url | e }}">
{% endif %}

{# ==== TWITTER ==== #}

<meta name="twitter:card" content="{% if meta_image_url %}summary_large_image{% else %}summary{% endif %}">
<meta name="twitter:title" content="{{ meta_title | e }}">

{% if meta_description %}
<meta name="twitter:description" content="{{ meta_description | e }}">
{% endif %}

{% if meta_image_url %}
<meta name="twitter:image" content="{{ meta_image_url | e }}">
{% endif %}

{% endblock %}